<!DOCTYPE html>
<html>
<head>
  <title>Simple Chat App</title>
  <script src="/socket.io/socket.io.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js"></script>
</head>
<body>
  <h1>Simple Chat App</h1>

  <div id="user-info" style="display: none;">
    <p id="user-email"></p>
    <button id="sign-out">Sign Out</button>
  </div>

  <div id="chat" style="display: none;">
    <ul id="messages"></ul>
    <form id="chat-form" action="">
      <input id="input-message" autocomplete="off" />
      <button>Send</button>
    </form>
  </div>

  <script>
    // Replace this with your own Firebase SDK configuration
    
    // Import the functions you need from the SDKs you need

import { initializeApp } from "firebase/app";
import { getAnalytics } from "firebase/analytics";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyA6Aqfj4NXt-lobpEq_IvYvvPRxQel7350",
  authDomain: "chatappmercor.firebaseapp.com",
  projectId: "chatappmercor",
  storageBucket: "chatappmercor.appspot.com",
  messagingSenderId: "609072945068",
  appId: "1:609072945068:web:0991346851ac8fe7758c09",
  measurementId: "G-5YQ6M0DK7W"
};

// Initialize Firebase
// const app = initializeApp(firebaseConfig);
// const analytics = getAnalytics(app);

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    // Google Sign-In
    const signInWithGoogle = () => {
      const provider = new firebase.auth.GoogleAuthProvider();
      auth.signInWithPopup(provider);
    };

    // Sign out
    const signOut = () => {
      auth.signOut();
    };

    auth.onAuthStateChanged((user) => {
      if (user) {
        $('#user-email').text(user.email);
        $('#user-info').show();
        $('#chat').show();
        $('#sign-out').click(signOut);
        $('#input-message').focus();
        initChat(user);
      } else {
        $('#user-info').hide();
        $('#chat').hide();
        $('#messages').empty();
        socket.close();
      }
    });

    const initChat = (user) => {
      user.getIdToken().then((token) => {
        const socket = io({
          query: {
            token: token,
          },
        });

        $('form').submit((e) => {
          e.preventDefault();
          const message = $('#input-message').val();
          if (message.trim() !== '') {
            socket.emit('chat message', message);
            $('#input-message').val('');
          }
          return false;
        });

        socket.on('chat message', (data) => {
          const { message, sender } = data;
          $('#messages').append($('<li>').text(`${sender}: ${message}`));
        });
      });
    };
  </script>

  <button onclick="signInWithGoogle()">Sign in with Google</button>
</body>
</html>
